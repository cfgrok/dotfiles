---
- name: Install XMonad
  ansible.builtin.apt:
    name:
    - libghc-xmonad-contrib-dev
    - libghc-xmonad-contrib-doc
    - libghc-xmonad-dev
    - libghc-xmonad-doc
    - suckless-tools
    - xmonad
  become: true

- name: Copy XMonad config
  ansible.builtin.copy:
    src: xmonad.hs
    dest: ~/.config/xmonad/

- name: Create XMonad cache directory
  ansible.builtin.file:
    path: ~/.cache/xmonad
    state: directory

- name: Create XMonad data directory
  ansible.builtin.file:
    path: ~/.local/share/xmonad
    state: directory

- name: Reset XMonad
  ansible.builtin.shell:
    cmd: xmonad --recompile

- name: Set window manager
  community.general.dconf:
    key: /org/mate/desktop/session/required-components/windowmanager
    value: "'xmonad'"

- name: Remove Mint menu super key mapping
  community.general.dconf:
    key: /com/linuxmint/mintmenu/hot-key
    value: "''"

- name: Add desktop config file
  ansible.builtin.copy:
    src: xmonad.desktop
    dest: /usr/share/applications/
  become: true

- name: Modify Mint desktop management script
  ansible.builtin.replace:
    path: /usr/lib/linuxmint/mintdesktop/mintdesktop.py
    regexp: '^(\s+)(settings.set_string\("windowmanager", "mint-window-manager"\))$'
    replace: '\1# \2'
  become: true
